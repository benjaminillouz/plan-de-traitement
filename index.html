<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello PdT - Plan de Traitement</title>
    <meta name="description" content="Application de plan de traitement dentaire interactive pour les professionnels">
    <link rel="icon" type="image/svg+xml" href="assets/tooth.svg">

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#e6f2f5',
                            100: '#cce5eb',
                            200: '#99ccd7',
                            300: '#66b2c3',
                            400: '#3399af',
                            500: '#004B63',
                            600: '#003d51',
                            700: '#002f3f',
                            800: '#00212d',
                            900: '#00131b',
                        },
                        dental: {
                            avulsion: '#ef4444',
                            restauration: '#22c55e',
                            endo: '#15803d',
                            implant: '#3b82f6',
                            transitoire: '#eab308',
                            definitive: '#0f766e',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }

        @media print {
            .no-print { display: none !important; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        .tooth { transition: all 0.15s ease; }
        .tooth:hover { transform: scale(1.15); z-index: 10; }
        .tooth.selected-avulsion { background-color: #ef4444; color: white; border-color: #dc2626; }
        .tooth.selected-restauration { background-color: #22c55e; color: white; border-color: #16a34a; }
        .tooth.selected-endo { background-color: #15803d; color: white; border-color: #166534; }
        .tooth.selected-implant { background-color: #3b82f6; color: white; border-color: #2563eb; }
        .tooth.selected-parodonto { background-color: #8b5cf6; color: white; border-color: #7c3aed; }
        .tooth.selected-transitoire { background-color: #eab308; color: #1f2937; border-color: #ca8a04; }
        .tooth.selected-definitive { background-color: #0f766e; color: white; border-color: #0d9488; }

        .tab-btn { transition: all 0.2s ease; }
        .tab-btn.active { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="bg-slate-50 font-sans antialiased min-h-screen">

    <!-- Header HelloParo Style -->
    <header class="bg-white border-b border-slate-200 shadow-sm sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <!-- Logo HelloPdT -->
                <div class="flex items-center gap-3">
                    <svg width="120" height="50" viewBox="0 0 180 70" class="flex-shrink-0">
                        <defs>
                            <linearGradient id="probingGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stop-color="#10B981" />
                                <stop offset="100%" stop-color="#004B63" />
                            </linearGradient>
                            <filter id="toothShadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity="0.15" />
                            </filter>
                        </defs>
                        <g filter="url(#toothShadow)">
                            <path d="M30 8 C25 8 22 12 22 18 L22 35 C22 42 25 46 28 46 C30 46 31 44 31 44 C31 44 32 46 34 46 C37 46 40 42 40 35 L40 18 C40 12 37 8 32 8 Z" fill="white" stroke="#004B63" stroke-width="2" />
                            <path d="M55 5 C49 5 45 10 45 17 L45 38 C45 46 49 51 53 51 C55 51 56 49 57 49 C58 49 59 51 61 51 C65 51 69 46 69 38 L69 17 C69 10 65 5 59 5 Z" fill="white" stroke="#004B63" stroke-width="2" />
                            <path d="M84 8 C79 8 76 12 76 18 L76 35 C76 42 79 46 82 46 C84 46 85 44 85 44 C85 44 86 46 88 46 C91 46 94 42 94 35 L94 18 C94 12 91 8 86 8 Z" fill="white" stroke="#004B63" stroke-width="2" />
                        </g>
                        <path d="M18 52 Q31 56 45 54 Q57 52 69 55 Q82 58 98 53" fill="none" stroke="url(#probingGradient)" stroke-width="3" stroke-linecap="round" />
                        <circle cx="25" cy="54" r="2.5" fill="#10B981" />
                        <circle cx="45" cy="53" r="2.5" fill="#22C55E" />
                        <circle cx="57" cy="53.5" r="2.5" fill="#004B63" />
                        <circle cx="69" cy="55" r="2.5" fill="#004B63" />
                        <circle cx="88" cy="54" r="2.5" fill="#004B63" />
                        <text x="115" y="28" font-family="Inter, sans-serif" font-size="16" font-weight="300" fill="#004B63">Hello</text>
                        <text x="115" y="48" font-family="Inter, sans-serif" font-size="18" font-weight="700" letter-spacing="3" fill="#004B63">PdT</text>
                    </svg>
                    <div id="header-context" class="hidden">
                        <p class="text-xs text-slate-500"><span id="header-center">-</span> - Plan de Traitement</p>
                    </div>
                </div>

                <!-- Patient Info Inputs -->
                <div class="flex items-center gap-3 flex-wrap">
                    <input type="text" id="patient-nom" placeholder="Nom du patient" class="px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent w-36">
                    <input type="text" id="patient-prenom" placeholder="Pr√©nom" class="px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent w-32">
                    <input type="date" id="date-traitement" class="px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                    <input type="text" id="praticien-nom" placeholder="Praticien" class="px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent w-44">
                </div>

                <!-- Practitioner Badge -->
                <div id="practitioner-badge" class="hidden items-center gap-2 px-3 py-1.5 bg-primary-50 rounded-lg border border-primary-200">
                    <svg class="w-4 h-4 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    <span id="practitioner-name" class="text-sm font-medium text-primary-800"></span>
                </div>

                <!-- Action Buttons -->
                <div class="flex items-center gap-2 flex-wrap">
                    <button id="savePlanButton" class="px-3 py-2 bg-emerald-500 text-white rounded-lg text-sm font-medium hover:bg-emerald-600 transition-colors shadow-md flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                        </svg>
                        Enregistrer
                    </button>
                    <button id="openPdfPreview" class="px-3 py-2 bg-primary-500 text-white rounded-lg text-sm font-medium hover:bg-primary-600 transition-colors shadow-md flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                        </svg>
                        PDF
                    </button>
                    <button onclick="resetForm()" class="px-3 py-2 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200 transition-colors">
                        R√©initialiser
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6">

        <!-- Tab Navigation -->
        <div class="flex items-center gap-2 mb-6 flex-wrap no-print">
            <button onclick="switchTab('assainissement')" id="tab-assainissement" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-red-500 text-white active">
                üßΩ Assainissement
            </button>
            <button onclick="switchTab('conservateurs')" id="tab-conservateurs" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-white text-slate-600 hover:bg-slate-100">
                ü™• Soins conservateurs
            </button>
            <button onclick="switchTab('complementaires')" id="tab-complementaires" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-white text-slate-600 hover:bg-slate-100">
                üîß Soins compl√©mentaires
            </button>
            <button onclick="switchTab('transitoires')" id="tab-transitoires" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-white text-slate-600 hover:bg-slate-100">
                ü¶∑ Proth√®ses transitoires
            </button>
            <button onclick="switchTab('definitives')" id="tab-definitives" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-white text-slate-600 hover:bg-slate-100">
                üëë Proth√®ses d√©finitives
            </button>
            <button onclick="switchTab('radiographies')" id="tab-radiographies" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-white text-slate-600 hover:bg-slate-100">
                ü©ª Radiographies
            </button>
            <button onclick="switchTab('photographies')" id="tab-photographies" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-white text-slate-600 hover:bg-slate-100">
                üì∑ Photographies
            </button>
            <button onclick="switchTab('notes')" id="tab-notes" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-white text-slate-600 hover:bg-slate-100">
                üìù Notes
            </button>
        </div>

        <!-- Tab Contents -->
        <div class="tab-contents">

            <!-- 1. Assainissement -->
            <div id="content-assainissement" class="tab-content bg-white rounded-2xl shadow-lg p-6 border border-slate-200 animate-fadeIn">
                <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center text-lg">üßΩ</span>
                    Assainissement
                </h2>
                <div class="space-y-4">
                    <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                        <input type="checkbox" id="detartrage" class="w-5 h-5 rounded border-slate-300 text-primary-600 focus:ring-primary-500">
                        <span class="text-slate-700 group-hover:text-slate-900">D√©tartrage</span>
                    </label>
                    <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                        <input type="checkbox" id="avulsion" onchange="toggleDentalChart(this, 'avulsion-chart')" class="w-5 h-5 rounded border-slate-300 text-red-600 focus:ring-red-500">
                        <span class="text-slate-700 group-hover:text-slate-900">Avulsions dentaires</span>
                    </label>
                    <div id="avulsion-chart" class="dental-chart hidden ml-8" data-type="avulsion"></div>
                </div>
            </div>

            <!-- 2. Soins conservateurs -->
            <div id="content-conservateurs" class="tab-content hidden bg-white rounded-2xl shadow-lg p-6 border border-slate-200 animate-fadeIn">
                <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center text-lg">ü™•</span>
                    Soins conservateurs
                </h2>
                <div class="space-y-4">
                    <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                        <input type="checkbox" id="restauration" onchange="toggleDentalChart(this, 'restauration-chart')" class="w-5 h-5 rounded border-slate-300 text-green-600 focus:ring-green-500">
                        <span class="text-slate-700 group-hover:text-slate-900">Restaurations</span>
                    </label>
                    <div id="restauration-chart" class="dental-chart hidden ml-8" data-type="restauration"></div>

                    <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                        <input type="checkbox" id="endo" onchange="toggleDentalChart(this, 'endo-chart')" class="w-5 h-5 rounded border-slate-300 text-emerald-700 focus:ring-emerald-600">
                        <span class="text-slate-700 group-hover:text-slate-900">Traitements endodontiques</span>
                    </label>
                    <div id="endo-chart" class="dental-chart hidden ml-8" data-type="endo"></div>
                </div>
            </div>

            <!-- 3. Soins compl√©mentaires -->
            <div id="content-complementaires" class="tab-content hidden bg-white rounded-2xl shadow-lg p-6 border border-slate-200 animate-fadeIn">
                <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center text-lg">üîß</span>
                    Soins compl√©mentaires
                </h2>
                <div class="space-y-4">
                    <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                        <input type="checkbox" id="implant" onchange="toggleDentalChart(this, 'implant-chart')" class="w-5 h-5 rounded border-slate-300 text-blue-600 focus:ring-blue-500">
                        <span class="text-slate-700 group-hover:text-slate-900">Pose d'implants</span>
                    </label>
                    <div id="implant-chart" class="dental-chart hidden ml-8" data-type="implant"></div>

                    <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                        <input type="checkbox" id="parodonto" onchange="toggleDentalChart(this, 'parodonto-chart')" class="w-5 h-5 rounded border-slate-300 text-violet-600 focus:ring-violet-500">
                        <span class="text-slate-700 group-hover:text-slate-900">Parodontologie</span>
                    </label>
                    <div id="parodonto-chart" class="dental-chart hidden ml-8" data-type="parodonto"></div>
                </div>
            </div>

            <!-- 4. Proth√®ses transitoires -->
            <div id="content-transitoires" class="tab-content hidden bg-white rounded-2xl shadow-lg p-6 border border-slate-200 animate-fadeIn">
                <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center text-lg">ü¶∑</span>
                    Proth√®ses transitoires
                </h2>
                <div class="space-y-4">
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 px-4 py-2 rounded-xl border-2 border-slate-200 hover:border-primary-300 cursor-pointer transition-colors has-[:checked]:border-primary-500 has-[:checked]:bg-primary-50">
                            <input type="radio" name="transitoires" value="oui" onclick="toggleDentalChartRadio('transitoire-chart', true)" class="w-4 h-4 text-primary-600 focus:ring-primary-500">
                            <span class="text-slate-700 font-medium">Oui</span>
                        </label>
                        <label class="flex items-center gap-2 px-4 py-2 rounded-xl border-2 border-slate-200 hover:border-slate-300 cursor-pointer transition-colors has-[:checked]:border-slate-400 has-[:checked]:bg-slate-50">
                            <input type="radio" name="transitoires" value="non" onclick="toggleDentalChartRadio('transitoire-chart', false)" class="w-4 h-4 text-slate-600 focus:ring-slate-500">
                            <span class="text-slate-700 font-medium">Non</span>
                        </label>
                    </div>
                    <div id="transitoire-chart" class="dental-chart hidden ml-8" data-type="transitoire"></div>
                </div>
            </div>

            <!-- 5. Proth√®ses d√©finitives -->
            <div id="content-definitives" class="tab-content hidden bg-white rounded-2xl shadow-lg p-6 border border-slate-200 animate-fadeIn">
                <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center text-lg">üëë</span>
                    Proth√®ses d√©finitives
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                            <input type="checkbox" id="inlay-core" onchange="toggleDentalChart(this, 'inlay-chart')" class="w-5 h-5 rounded border-slate-300 text-teal-600 focus:ring-teal-500">
                            <span class="text-slate-700 group-hover:text-slate-900">Inlay Core</span>
                        </label>
                        <div id="inlay-chart" class="dental-chart hidden" data-type="definitive"></div>

                        <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                            <input type="checkbox" id="couronne" onchange="toggleDentalChart(this, 'couronne-chart')" class="w-5 h-5 rounded border-slate-300 text-teal-600 focus:ring-teal-500">
                            <span class="text-slate-700 group-hover:text-slate-900">Couronnes</span>
                        </label>
                        <div id="couronne-chart" class="dental-chart hidden" data-type="definitive"></div>
                    </div>
                    <div class="space-y-4">
                        <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                            <input type="checkbox" id="onlay" onchange="toggleDentalChart(this, 'onlay-chart')" class="w-5 h-5 rounded border-slate-300 text-teal-600 focus:ring-teal-500">
                            <span class="text-slate-700 group-hover:text-slate-900">Inlay / Onlay</span>
                        </label>
                        <div id="onlay-chart" class="dental-chart hidden" data-type="definitive"></div>

                        <label class="flex items-center gap-3 p-3 rounded-xl hover:bg-slate-50 cursor-pointer transition-colors group">
                            <input type="checkbox" id="prothese-amovible" onchange="toggleDentalChart(this, 'prothese-chart')" class="w-5 h-5 rounded border-slate-300 text-teal-600 focus:ring-teal-500">
                            <span class="text-slate-700 group-hover:text-slate-900">Proth√®ses amovibles</span>
                        </label>
                        <div id="prothese-chart" class="dental-chart hidden" data-type="definitive"></div>
                    </div>
                </div>
            </div>

            <!-- 6. Radiographies -->
            <div id="content-radiographies" class="tab-content hidden bg-white rounded-2xl shadow-lg p-6 border border-slate-200 animate-fadeIn">
                <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-lg">ü©ª</span>
                    Radiographies
                </h2>

                <div class="mb-6">
                    <button id="captureScreen" class="px-4 py-3 bg-teal-500 text-white rounded-lg font-medium hover:bg-teal-600 transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        Capturer une radiographie
                    </button>
                    <p class="text-xs text-slate-500 mt-2">Cliquez pour s√©lectionner une fen√™tre ou un √©cran contenant la radiographie √† capturer</p>
                </div>

                <div id="radiographs-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- Radiographs will be added here -->
                </div>

                <div id="radiographs-empty" class="text-center py-12 text-slate-500">
                    <svg class="w-16 h-16 mx-auto mb-4 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <p class="font-medium">Aucune radiographie</p>
                    <p class="text-sm">Utilisez le bouton ci-dessus pour capturer une radiographie</p>
                </div>
            </div>

            <!-- 7. Photographies -->
            <div id="content-photographies" class="tab-content hidden bg-white rounded-2xl shadow-lg p-6 border border-slate-200 animate-fadeIn">
                <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center text-lg">üì∑</span>
                    Photographies
                </h2>

                <!-- QR Code Section -->
                <div class="mb-6 p-6 bg-indigo-50 rounded-xl border border-indigo-200">
                    <div class="flex flex-col md:flex-row items-center gap-6">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-indigo-900 mb-2">
                                üì± Ajouter une photo depuis votre t√©l√©phone
                            </h3>
                            <p class="text-sm text-indigo-700 mb-4">
                                Scannez le QR code avec votre t√©l√©phone pour prendre une photo qui sera automatiquement ajout√©e au dossier patient.
                            </p>

                            <!-- Generate QR Code Button -->
                            <div id="peer-idle">
                                <button id="generateQrBtn" class="px-4 py-3 bg-indigo-500 text-white rounded-lg font-medium hover:bg-indigo-600 transition-colors flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                    </svg>
                                    G√©n√©rer un QR Code
                                </button>
                            </div>

                            <!-- Waiting Status -->
                            <div id="peer-waiting" class="hidden">
                                <div class="flex items-center gap-2 text-indigo-600">
                                    <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <span class="font-medium">En attente de connexion...</span>
                                </div>
                                <button id="cancelQrBtn" class="mt-2 text-sm text-slate-500 hover:text-slate-700 underline">
                                    Annuler
                                </button>
                            </div>

                            <!-- Connected Status -->
                            <div id="peer-connected" class="hidden">
                                <div class="flex items-center gap-2 text-green-600">
                                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="font-medium">T√©l√©phone connect√© !</span>
                                </div>
                                <p class="text-sm text-green-700 mt-1">Prenez une photo avec votre t√©l√©phone</p>
                            </div>
                        </div>

                        <!-- QR Code Display -->
                        <div id="qr-container" class="hidden flex flex-col items-center">
                            <div class="bg-white p-3 rounded-xl shadow-md">
                                <div id="qr-code-container" class="w-48 h-48"></div>
                            </div>
                            <p class="text-xs text-indigo-600 mt-2 text-center">
                                Scannez avec votre t√©l√©phone
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Alternative: File Upload -->
                <div class="mb-6">
                    <p class="text-sm text-slate-500 mb-2">Ou importez des photos depuis votre ordinateur :</p>
                    <label for="photoUpload" class="inline-flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-700 rounded-lg font-medium hover:bg-slate-200 transition-colors cursor-pointer">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                        </svg>
                        Importer des fichiers
                    </label>
                    <input type="file" id="photoUpload" multiple accept="image/*" class="hidden">
                </div>

                <div id="photos-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- Photos will be added here -->
                </div>

                <div id="photos-empty" class="text-center py-12 text-slate-500">
                    <svg class="w-16 h-16 mx-auto mb-4 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <p class="font-medium">Aucune photo</p>
                    <p class="text-sm">G√©n√©rez un QR code ou importez des photos</p>
                </div>
            </div>

            <!-- 8. Notes -->
            <div id="content-notes" class="tab-content hidden bg-white rounded-2xl shadow-lg p-6 border border-slate-200 animate-fadeIn">
                <h2 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center text-lg">üìù</span>
                    Notes compl√©mentaires
                </h2>
                <textarea id="notes" rows="8" placeholder="Ajoutez des notes ou observations compl√©mentaires..." class="w-full px-4 py-3 border border-slate-200 rounded-xl text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none transition-shadow"></textarea>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 mt-12 py-6 no-print">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm text-slate-500">¬© 2024 <span class="font-semibold text-primary-600">Hello PdT</span> - Plan de Traitement Dentaire</p>
        </div>
    </footer>

    <!-- Loading Modal -->
    <div id="loadingModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 shadow-2xl flex flex-col items-center gap-4">
            <div class="w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin"></div>
            <p class="text-slate-700 font-medium">Enregistrement en cours...</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed bottom-6 right-6 z-50 flex flex-col gap-3"></div>

    <!-- PDF Preview Modal -->
    <div id="pdfModal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[95vh] flex flex-col overflow-hidden">
            <!-- Modal Header -->
            <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200 bg-slate-50">
                <h3 class="text-lg font-semibold text-slate-800">Aper√ßu du PDF</h3>
                <div class="flex items-center gap-2">
                    <!-- Download Button -->
                    <button id="downloadPdfBtn" class="px-4 py-2 bg-emerald-500 text-white rounded-lg text-sm font-medium hover:bg-emerald-600 transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        T√©l√©charger
                    </button>
                    <!-- Print Button -->
                    <button id="printPdfBtn" class="px-4 py-2 bg-primary-500 text-white rounded-lg text-sm font-medium hover:bg-primary-600 transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                        </svg>
                        Imprimer
                    </button>
                    <!-- Share Dropdown -->
                    <div class="relative">
                        <button id="sharePdfBtn" class="px-4 py-2 bg-indigo-500 text-white rounded-lg text-sm font-medium hover:bg-indigo-600 transition-colors flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                            </svg>
                            Partager
                            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <!-- Dropdown Menu -->
                        <div id="shareDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-slate-200 py-2 z-10">
                            <button id="shareWhatsappBtn" class="w-full px-4 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-3">
                                <svg class="w-5 h-5 text-green-500" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                                </svg>
                                WhatsApp
                            </button>
                            <button id="shareEmailBtn" class="w-full px-4 py-2 text-left text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-3">
                                <svg class="w-5 h-5 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                                Email
                            </button>
                        </div>
                    </div>
                    <!-- Close Button -->
                    <button id="closePdfModal" class="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- PDF Preview Container -->
            <div class="flex-1 overflow-auto bg-slate-200 p-6">
                <div id="pdfPreviewContainer" class="mx-auto bg-white shadow-xl" style="width: 210mm; min-height: 297mm;">
                    <!-- PDF content will be rendered here -->
                </div>
            </div>
            <!-- Generating Indicator -->
            <div id="pdfGenerating" class="hidden absolute inset-0 bg-white/90 flex flex-col items-center justify-center">
                <div class="w-12 h-12 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mb-4"></div>
                <p class="text-slate-700 font-medium">G√©n√©ration du PDF...</p>
            </div>
        </div>
    </div>

    <!-- jsPDF & html2canvas Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- PeerJS & QRCode Libraries -->
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Scripts -->
    <script>
        // Tab switching logic
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Reset all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-red-500', 'bg-green-500', 'bg-blue-500', 'bg-yellow-500', 'bg-teal-500', 'bg-purple-500', 'bg-indigo-500', 'bg-slate-500', 'text-white');
                btn.classList.add('bg-white', 'text-slate-600');
            });

            // Show selected tab content
            document.getElementById('content-' + tabName).classList.remove('hidden');

            // Style active tab button
            const activeBtn = document.getElementById('tab-' + tabName);
            activeBtn.classList.remove('bg-white', 'text-slate-600');
            activeBtn.classList.add('active', 'text-white');

            // Add appropriate color
            const colors = {
                'assainissement': 'bg-red-500',
                'conservateurs': 'bg-green-500',
                'complementaires': 'bg-blue-500',
                'transitoires': 'bg-yellow-500',
                'definitives': 'bg-teal-500',
                'radiographies': 'bg-purple-500',
                'photographies': 'bg-indigo-500',
                'notes': 'bg-slate-500'
            };
            activeBtn.classList.add(colors[tabName]);
        }

        // Reset form
        function resetForm() {
            if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser le formulaire ?')) {
                location.reload();
            }
        }

        // Initialize date
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('date-traitement').valueAsDate = new Date();
        });
    </script>
    <script src="js/dental-chart.js"></script>
    <script src="js/file-upload.js"></script>
    <script src="js/screenshot.js"></script>
    <script src="js/pdf-generator.js"></script>
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
